<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¬èˆ¹é½Šç™¼ï¼šå¾Œå‹¤å¤§å´©æ½° (æ•˜äº‹ç‰ˆ)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Oswald:wght@700&display=swap');

        body { font-family: 'Noto Sans TC', sans-serif; background-color: #0f172a; color: #e2e8f0; overflow: hidden; user-select: none; touch-action: none; }
        
        /* å‹•ç•«é¡ */
        .fade-in { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        /* ç•«é¢åŸºç¤è¨­å®šï¼šé è¨­å…è¨±å‚ç›´æ²å‹•ä»¥é©æ‡‰ä¸åŒè¢å¹• */
        .screen { 
            display: none; 
            height: 100vh; 
            width: 100vw; 
            flex-direction: column; 
            overflow-y: auto; /* é—œéµï¼šé–‹å•Ÿæ»¾è¼ª */
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch; /* iOS æ»‘å‹•å„ªåŒ– */
        }
        .active-screen { display: flex; }

        /* éŠæˆ²é—œå¡å¼·åˆ¶é–å®šç•«é¢ï¼Œä¸é¡¯ç¤ºæ»¾è¼ª (é¿å…éŠæˆ²ä¸­èª¤è§¸) */
        #screen-level2, #screen-level3 {
            overflow: hidden;
            touch-action: none;
        }

        /* Level 1 æŠ•å½±ç‰‡æ¨£å¼ */
        .slide-container { display: none; height: 100%; flex-direction: column; justify-content: center; items-center; padding: 20px; animation: slideEnter 0.5s ease-out; }
        .active-slide { display: flex; }
        @keyframes slideEnter { from { opacity: 0; transform: translateX(50px); } to { opacity: 1; transform: translateX(0); } }

        /* Level 3 ç‰¹æ•ˆ */
        .foxhole {
            background: radial-gradient(circle, #292524 40%, #57534e 70%);
            box-shadow: inset 0 5px 10px rgba(0,0,0,0.8);
            border-radius: 50%;
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }
        
        .soldier-pop { transition: transform 0.1s ease-in; transform: translateY(0); }
        /* åŠ ä¸Š !important ç¢ºä¿è¦†è“‹ä»»ä½•æ®˜ç•™çš„è¡Œå…§æ¨£å¼ */
        .soldier-hide { transform: translateY(120%) !important; opacity: 0.5; }
        
        .aim-reticle {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 80%; height: 80%;
            border: 4px solid red; border-radius: 50%;
            animation: lockOn 2s linear forwards;
            pointer-events: none;
            opacity: 0;
        }
        @keyframes lockOn {
            0% { transform: translate(-50%, -50%) scale(2); opacity: 0; border-color: yellow; }
            50% { opacity: 1; border-color: orange; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 1; border-color: red; }
        }

        .explosion {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle, orange, red, transparent);
            opacity: 0;
            pointer-events: none;
        }
        .boom-anim { animation: boom 0.5s ease-out; }
        @keyframes boom { 0% { opacity: 1; transform: scale(0.5); } 100% { opacity: 0; transform: scale(2); } }

        .news-ticker-item { border-left: 2px solid #ef4444; padding-left: 8px; margin-bottom: 8px; animation: fadeIn 0.3s; }

        /* æ›¸å°è£é£¾ */
        .book-cover {
            background-color: #b91c1c; 
            background-image: url('https://www.transparenttextures.com/patterns/black-scales.png');
            box-shadow: 10px 10px 20px rgba(0,0,0,0.5);
            position: relative;
            overflow: hidden;
        }
    </style>
</head>
<body>

    <!-- ==================== ä¸»é¸å–® ==================== -->
    <div id="screen-menu" class="screen active-screen bg-gradient-to-br from-gray-900 to-blue-900">
        <!-- ä¿®æ­£ï¼šç§»é™¤ justify-centerï¼Œæ”¹ç”¨å­å…ƒç´  my-autoã€‚é€™æ¨£ç•¶å…§å®¹éé•·æ™‚ï¼Œé ‚éƒ¨ä¸æœƒè¢«åˆ‡æ‰ï¼Œä¸”å¯ä»¥æ­£å¸¸æ»¾å‹•ã€‚ -->
        <div class="min-h-full w-full flex flex-col items-center py-10 px-4">
            
            <div class="text-center space-y-6 fade-in p-8 border border-gray-700 bg-gray-800/80 rounded-2xl shadow-2xl max-w-4xl w-full relative overflow-hidden my-auto">
                <h1 class="text-4xl md:text-5xl font-black text-red-500 tracking-tighter mb-2">è¬èˆ¹é½Šç™¼</h1>
                <h2 class="text-xl md:text-2xl font-bold text-gray-300">Operation: Logistics Nightmare</h2>
                <p class="text-sm md:text-base text-gray-400">é«”é©—ç‰©ç†é™åˆ¶ä¸‹çš„çœŸå¯¦ç™»é™¸æˆ°</p>
                
                <!-- ä¿®æ”¹ï¼šå¼·åˆ¶ grid-cols-3 è®“é¸é …æ°´å¹³ä¸¦ç½®ï¼Œä¸¦èª¿æ•´ gap èˆ‡å¯¬åº¦ -->
                <div class="grid grid-cols-3 gap-2 md:gap-6 mt-8 w-full">
                    
                    <!-- ç¬¬ä¸€ç« æŒ‰éˆ•ï¼šèª¿æ•´ padding èˆ‡å­—é«”å¤§å°ä»¥é©æ‡‰æ‰‹æ©Ÿæ°´å¹³æ’åˆ— -->
                    <button onclick="GameApp.startLevel(1)" class="flex flex-col items-center justify-center p-3 md:p-6 bg-gray-700 hover:bg-gray-600 rounded-xl transition border-2 border-gray-600 hover:border-yellow-500 group relative overflow-hidden h-full">
                        <div class="text-2xl md:text-4xl mb-1 md:mb-2">ğŸ“–</div>
                        <div class="font-bold text-sm md:text-xl group-hover:text-yellow-400">ç¬¬ä¸€ç« </div>
                        <div class="text-[10px] md:text-xs text-gray-400 mt-1 leading-tight">æˆ°å‰ç§‘æ™®<br class="md:hidden">ç™»èˆ¹å›°é›£</div>
                    </button>

                    <!-- ç¬¬äºŒç« æŒ‰éˆ• -->
                    <button onclick="GameApp.startLevel(2)" class="flex flex-col items-center justify-center p-3 md:p-6 bg-gray-700 hover:bg-gray-600 rounded-xl transition border-2 border-gray-600 hover:border-blue-500 group h-full">
                        <div class="text-2xl md:text-4xl mb-1 md:mb-2">ğŸŒŠ</div>
                        <div class="font-bold text-sm md:text-xl group-hover:text-blue-400">ç¬¬äºŒç« </div>
                        <div class="text-[10px] md:text-xs text-gray-400 mt-1 leading-tight">æµ·å³½ç”Ÿå­˜<br class="md:hidden">é–ƒé¿å½ˆå¹•</div>
                    </button>

                    <!-- ç¬¬ä¸‰ç« æŒ‰éˆ• -->
                    <button onclick="GameApp.startLevel(3)" class="flex flex-col items-center justify-center p-3 md:p-6 bg-gray-700 hover:bg-gray-600 rounded-xl transition border-2 border-gray-600 hover:border-red-500 group h-full">
                        <div class="text-2xl md:text-4xl mb-1 md:mb-2">ğŸ’£</div>
                        <div class="font-bold text-sm md:text-xl group-hover:text-red-400">ç¬¬ä¸‰ç« </div>
                        <div class="text-[10px] md:text-xs text-gray-400 mt-1 leading-tight">ç˜é ­èº²é¿<br class="md:hidden">ç”Ÿå­˜æŒ‘æˆ°</div>
                    </button>
                </div>

                <!-- åƒè€ƒæ–‡ç»æŒ‰éˆ•ï¼šç½®æ–¼ä¸‹æ–¹ -->
                <div class="mt-8 border-t border-gray-700 pt-6">
                    <button onclick="GameApp.showReference()" class="w-full md:w-auto text-gray-400 hover:text-white text-sm flex items-center justify-center gap-2 mx-auto px-6 py-3 hover:bg-gray-700 rounded-lg transition border border-transparent hover:border-gray-500">
                        <span>ğŸ“š</span>
                        <span>åƒè€ƒè³‡æ–™èˆ‡æ›¸ç±ä¾†æº</span>
                    </button>
                </div>
            </div>
            
        </div>
    </div>

    <!-- ==================== åƒè€ƒè³‡æ–™ç•«é¢ ==================== -->
    <div id="screen-reference" class="screen bg-stone-900">
        <!-- ä¿®æ­£ï¼šåŒæ¨£ä½¿ç”¨ flex-col + items-center + my-auto ç¢ºä¿æ»¾å‹•é«”é©— -->
        <div class="min-h-full w-full flex flex-col items-center py-10 px-4">
            
            <div class="flex flex-col md:flex-row gap-8 items-center bg-gray-800 p-8 rounded-2xl border border-gray-700 shadow-2xl max-w-4xl w-full my-auto">
                
                <!-- æ›¸å°å€å¡Šï¼šåŒ…å«åœ–ç‰‡èˆ‡ CSS å¾Œå‚™æ–¹æ¡ˆ -->
                <div class="flex-shrink-0 relative group mx-auto md:mx-0 w-64 h-96 shadow-2xl rounded-lg">
                    
                    <!-- 1. å„ªå…ˆå˜—è©¦é¡¯ç¤ºåœ–ç‰‡ -->
                    <!-- æ³¨æ„ï¼šä¸‹è¼‰å¾Œè«‹ç¢ºä¿ 'é˜¿å…±æ‰“éä¾†è©²æ€éº¼è¾¦.jpg' èˆ‡æ­¤ html åœ¨åŒä¸€è³‡æ–™å¤¾ -->
                    <img id="book-real-img"
                         src="é˜¿å…±æ‰“éä¾†è©²æ€éº¼è¾¦.jpg" 
                         alt="é˜¿å…±æ‰“ä¾†æ€éº¼è¾¦ æ›¸å°" 
                         class="absolute inset-0 w-full h-full object-cover rounded-lg z-20 transition transform group-hover:scale-105 duration-300"
                         onerror="document.getElementById('book-real-img').style.display='none'; document.getElementById('book-css-fallback').classList.remove('hidden');">
                    
                    <!-- 2. åœ–ç‰‡è®€å–å¤±æ•—æ™‚çš„ CSS ç¹ªè£½å°é¢ (Fallback) -->
                    <div id="book-css-fallback" class="book-cover w-full h-full flex flex-col justify-between p-6 absolute inset-0 z-10 hidden rounded-lg transform transition group-hover:scale-105 duration-300">
                        <div class="book-texture absolute inset-0 pointer-events-none"></div>
                        <div class="relative z-10">
                            <div class="text-yellow-400 font-['Oswald'] text-4xl leading-none mb-2 drop-shadow-md">
                                IF CHINA<br>ATTACKS
                            </div>
                            <div class="text-white font-black text-5xl leading-tight drop-shadow-md">
                                é˜¿å…±æ‰“ä¾†<br>æ€éº¼è¾¦
                            </div>
                        </div>
                        <div class="relative z-10 border-t border-white/30 pt-2 mt-4">
                            <div class="text-white text-xs opacity-80 mb-1">Taiwan Strait Military Knowledge</div>
                            <div class="text-white font-bold text-sm">ç‹ç«‹ Matt Wang<br>æ²ˆä¼¯æ´‹ Puma Shen</div>
                        </div>
                        <div class="absolute bottom-0 right-0 opacity-20 text-black text-9xl pointer-events-none">ğŸï¸</div>
                    </div>

                    <!-- è£é£¾å…‰æšˆ -->
                    <div class="absolute -inset-1 bg-gradient-to-r from-red-600 to-yellow-600 rounded-lg blur opacity-25 group-hover:opacity-50 transition duration-1000 group-hover:duration-200 -z-10"></div>
                </div>

                <div class="flex-1 space-y-4 text-gray-300">
                    <h2 class="text-3xl font-bold text-white mb-4 border-b border-gray-600 pb-2">é—œæ–¼æœ¬éŠæˆ²</h2>
                    <p>æœ¬éŠæˆ²çš„é—œå¡è¨­è¨ˆèˆ‡ç§‘æ™®å…§å®¹ï¼Œçš†æ”¹ç·¨è‡ªæš¢éŠ·ç§‘æ™®æ›¸ç±<span class="text-yellow-400 font-bold">ã€Šé˜¿å…±æ‰“ä¾†æ€éº¼è¾¦ï¼šä½ ä»¥ç‚ºçŸ¥é“ä½†å¯¦éš›ä¸€ç„¡æ‰€çŸ¥çš„å°æµ·è»äº‹å¸¸è­˜ã€‹</span>ã€‚</p>
                    <ul class="list-disc list-inside space-y-2 text-sm bg-black/30 p-4 rounded-lg">
                        <li><span class="text-green-400 font-bold">ç¬¬ä¸€é—œï¼ˆç™»èˆ¹ï¼‰ï¼š</span>ç ´è§£ã€Œè¬èˆ¹é½Šç™¼ã€è¬ è¨€ã€‚é»å‡ºæ°‘ç”¨æ¼èˆ¹åœ¨è£è¼‰æ­¦è£éƒ¨éšŠèˆ‡è£œçµ¦æ™‚ï¼Œé¢è‡¨çš„ç‰©ç†é™åˆ¶èˆ‡æ™‚é–“æˆæœ¬ã€‚</li>
                        <li><span class="text-blue-400 font-bold">ç¬¬äºŒé—œï¼ˆæ¸¡æµ·ï¼‰ï¼š</span>æ¨¡æ“¬éæ­£è¦è¼‰å…·åœ¨å°æµ·é¢¨æµªèˆ‡ç¾ä»£åŒ–ç«åŠ›é¢å‰çš„è„†å¼±æ€§ã€‚</li>
                        <li><span class="text-red-400 font-bold">ç¬¬ä¸‰é—œï¼ˆç™»é™¸ï¼‰ï¼š</span>å±•ç¤ºè¼•è£æ­¥å…µåœ¨ç¼ºä¹é‡è£å‚™èˆ‡åˆ¶ç©ºæ¬Šçš„æƒ…æ³ä¸‹ï¼Œé›£ä»¥åœ¨ç˜é ­å°æŠ—ä¸»æˆ°å¦å…‹ã€‚</li>
                    </ul>
                    <p class="text-sm italic text-gray-500 mt-4">â€» æœ¬éŠæˆ²æ—¨åœ¨ä»¥äº’å‹•æ–¹å¼å‚³éè»äº‹ç§‘æ™®çŸ¥è­˜ï¼Œç ´é™¤å¸¸è¦‹çš„æ”»å°è¬ è¨€èˆ‡ææ‡¼ã€‚</p>
                    <button onclick="GameApp.backToMenu()" class="mt-6 bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 px-8 rounded-lg shadow-lg transition transform hover:scale-105 w-full md:w-auto">
                        â¬…ï¸ è¿”å›ä¸»é¸å–®
                    </button>
                </div>
            </div>

        </div>
    </div>

    <!-- ==================== ç¬¬ä¸€é—œï¼šç§‘æ™®åœ–æ–‡ ==================== -->
    <div id="screen-level1" class="screen bg-gray-900 relative">
        <header class="h-16 bg-gray-800 border-b border-gray-700 flex-shrink-0 flex justify-between items-center px-4 z-20">
            <div>
                <h3 class="text-yellow-500 font-bold">ç¬¬ä¸€ç« ï¼šç¢¼é ­ä½œæ¥­è§£å¯†</h3>
                <p class="text-[10px] text-gray-400">é»æ“Šç•«é¢æˆ–æŒ‰éˆ•é€²è¡Œä¸‹ä¸€é </p>
            </div>
            <button onclick="GameApp.backToMenu()" class="text-xs bg-gray-700 hover:bg-gray-600 px-3 py-1 rounded">é€€å‡º</button>
        </header>

        <div class="flex-1 relative overflow-y-auto flex flex-col items-center p-4 bg-[url('https://www.transparenttextures.com/patterns/blueprint.png')]">
            
            <!-- Slides Container -->
            <div class="w-full max-w-2xl my-auto">
                <!-- Slide 0 -->
                <div id="l1-slide-0" class="slide-container active-slide w-full">
                    <div class="bg-gray-800 p-6 rounded-2xl border border-gray-600 shadow-2xl w-full">
                        <div class="flex justify-center items-center gap-8 mb-6 h-48 bg-gray-900 rounded-xl relative overflow-hidden">
                            <div class="text-center opacity-50 grayscale">
                                <div class="text-6xl mb-2">ğŸ–±ï¸</div>
                                <div class="text-xs">ä¸–ç´€å¸åœ‹</div>
                                <div class="text-sm font-bold">é»ä¸€ä¸‹å°±ä¸Šèˆ¹</div>
                            </div>
                            <div class="w-1 h-32 bg-gray-700"></div>
                            <div class="text-center relative">
                                <div class="text-6xl mb-2 animate-bounce">ğŸªœ</div>
                                <div class="text-xs text-yellow-400">çœŸå¯¦ä¸–ç•Œ</div>
                                <div class="text-sm font-bold text-white">è¦çˆ¬æ¢¯å­ï¼</div>
                            </div>
                        </div>
                        <h2 class="text-2xl font-bold text-yellow-500 mb-2">01. ä¸Šèˆ¹ä¸æ˜¯é»æ»‘é¼ </h2>
                        <p class="text-gray-300 leading-relaxed">
                            ã€Œè¬èˆ¹é½Šç™¼ã€æœ€å¸¸è¢«å¿½è¦–çš„ç‰©ç†é™åˆ¶å°±æ˜¯<span class="text-white font-bold">ç™»èˆ¹é€Ÿåº¦</span>ã€‚
                            ä¸åƒé›»ç©éŠæˆ²ï¼Œç¾å¯¦ä¸­çš„æ¼èˆ¹æ²’æœ‰å¯¬æ•çš„è·³æ¿ã€‚å…¨å‰¯æ­¦è£çš„å£«å…µå¿…é ˆä¸€å€‹å€‹æ”€çˆ¬æ–æ™ƒçš„ç¹©æ¢¯æˆ–çª„æ¢¯ã€‚
                        </p>
                    </div>
                </div>

                <!-- Slide 1 -->
                <div id="l1-slide-1" class="slide-container w-full">
                    <div class="bg-gray-800 p-6 rounded-2xl border border-gray-600 shadow-2xl w-full">
                        <div class="flex justify-center items-center mb-6 h-48 bg-gray-900 rounded-xl">
                            <div class="relative">
                                <div class="text-8xl">ğŸª–</div>
                                <div class="absolute -right-4 top-0 text-6xl">ğŸ’</div>
                                <div class="absolute -left-4 bottom-0 text-6xl">ğŸ“¦</div>
                            </div>
                        </div>
                        <h2 class="text-2xl font-bold text-yellow-500 mb-2">02. å£«å…µä¸æ˜¯éŠå®¢</h2>
                        <p class="text-gray-300 leading-relaxed">
                            å£«å…µä¸Šæˆ°å ´ä¸èƒ½åªå¸¶æ‰‹æ©Ÿã€‚æ§æ¢°ã€å½ˆè—¥ã€å£ç³§ã€é€šè¨Šå™¨æã€æ°´...
                            <span class="text-white font-bold">æ¯å€‹äººéƒ½åƒä¸€åº§ç§»å‹•çš„å°å±±</span>ã€‚
                            é€™äº›ç‰©è³‡å¿…é ˆåœ¨èˆ¹è‰™åº•éƒ¨å †ç–Šæ•´é½Šä»¥ç¶­æŒé‡å¿ƒï¼Œå¦å‰‡å‡ºæµ·é‡åˆ°æµªå°±æœƒç¿»èˆ¹ã€‚
                        </p>
                    </div>
                </div>

                <!-- Slide 2 -->
                <div id="l1-slide-2" class="slide-container w-full">
                    <div class="bg-gray-800 p-6 rounded-2xl border border-gray-600 shadow-2xl w-full">
                        <div class="flex flex-col justify-center items-center mb-6 h-48 bg-gray-900 rounded-xl relative overflow-hidden">
                            <div class="flex gap-1 animate-pulse">
                                <span class="text-4xl">ğŸ›¥ï¸</span><span class="text-4xl">ğŸ›¥ï¸</span><span class="text-4xl">ğŸ›¥ï¸</span>
                            </div>
                            <div class="w-full h-1 bg-gray-600 my-2"></div>
                            <div class="flex flex-wrap justify-center gap-1 text-2xl text-gray-500">
                                ğŸ‘¨â€âœˆï¸ğŸ‘¨â€âœˆï¸ğŸ‘¨â€âœˆï¸ğŸ‘¨â€âœˆï¸ğŸ‘¨â€âœˆï¸ğŸ‘¨â€âœˆï¸ğŸ‘¨â€âœˆï¸ğŸ‘¨â€âœˆï¸ğŸ‘¨â€âœˆï¸<br>
                                ğŸ¤¬ğŸ¤¬ğŸ¤¬ğŸ¤¬ğŸ¤¬ğŸ¤¬ğŸ¤¬ğŸ¤¬ğŸ¤¬
                            </div>
                        </div>
                        <h2 class="text-2xl font-bold text-yellow-500 mb-2">03. ç¢¼é ­ç©ºé–“æœ‰é™</h2>
                        <p class="text-gray-300 leading-relaxed">
                            ä¸€å€‹æ¼æ¸¯èƒ½åŒæ™‚åœé å¹¾è‰˜èˆ¹ï¼Ÿå‡è¨­ä¸€æ¬¡ 50 è‰˜ï¼Œè£æ»¿é€™æ‰¹è¦åŠå°æ™‚ã€‚
                            é‚£å‰©ä¸‹çš„å¹¾åƒè‰˜èˆ¹å‘¢ï¼Ÿå‰©ä¸‹çš„å¹¾è¬åå£«å…µå‘¢ï¼Ÿ
                            <span class="text-white font-bold">ä»–å€‘åªèƒ½åœ¨å²¸ä¸Šæ’éšŠã€‚</span>
                            é€™æœƒå°è‡´åš´é‡çš„äº¤é€šå µå¡èˆ‡å¾Œå‹¤å´©æ½°ã€‚
                        </p>
                    </div>
                </div>

                <!-- Slide 3 -->
                <div id="l1-slide-3" class="slide-container w-full">
                    <div class="bg-gray-800 p-6 rounded-2xl border border-gray-600 shadow-2xl w-full text-center">
                        <div class="text-8xl mb-6">ğŸ“‰</div>
                        <h2 class="text-3xl font-bold text-red-500 mb-4">çµè«–ï¼šé€™æ˜¯ä¸å¯èƒ½çš„ä»»å‹™</h2>
                        <p class="text-gray-300 leading-relaxed mb-8 text-left">
                            æƒ³è¦ç”¨æ¼èˆ¹è¼‰é‹å¤§è»ï¼Œåœ¨é‚„æ²’å‡ºç™¼å‰ï¼Œå°±æœƒè¢«ã€Œæ™‚é–“ã€èˆ‡ã€Œç‰©ç†ç©ºé–“ã€æ‰“æ•—ã€‚
                            <br><br>
                            ä½†å‡è¨­...ä½ çœŸçš„å‹‰å¼·å‡ºç™¼äº†å‘¢ï¼Ÿ
                        </p>
                        <button onclick="GameApp.startLevel(2)" class="bg-red-600 hover:bg-red-500 text-white text-xl font-bold py-4 px-12 rounded-full shadow-lg transform transition hover:scale-105 animate-pulse">
                            é€²å…¥ç¬¬äºŒç« ï¼šæµ·å³½ç”Ÿå­˜æˆ° â¡ï¸
                        </button>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="flex-shrink-0 mt-8 mb-4 flex gap-4" id="l1-controls">
                <button onclick="L1Game.prev()" class="bg-gray-700 hover:bg-gray-600 text-white px-6 py-2 rounded-full font-bold">â¬…ï¸ ä¸Šä¸€é </button>
                <button onclick="L1Game.next()" class="bg-blue-600 hover:bg-blue-500 text-white px-6 py-2 rounded-full font-bold">ä¸‹ä¸€é  â¡ï¸</button>
            </div>
            <div class="flex-shrink-0 mb-2 text-xs text-gray-500">
                <span id="l1-page-indicator">1 / 4</span>
            </div>
        </div>
    </div>

    <!-- ==================== ç¬¬äºŒé—œï¼šæµ·å³½æ¸¡æµ· ==================== -->
    <div id="screen-level2" class="screen bg-blue-900 relative overflow-hidden">
        <canvas id="l2-canvas" class="absolute inset-0 w-full h-full"></canvas>
        <div class="absolute top-0 left-0 w-full p-4 flex justify-between items-start pointer-events-none z-10">
            <div class="bg-black/60 p-3 rounded-lg border border-gray-600 text-white text-sm shadow-xl">
                <div class="flex items-center gap-2">
                    <span class="text-yellow-400 font-bold">è·é›¢å°ç£:</span> 
                    <span id="l2-dist" class="font-mono text-lg">100.0</span> km
                </div>
                <div class="flex items-center gap-2 mt-1">
                    <span class="text-green-400 font-bold">èˆ¹éšŠå…µåŠ›:</span> 
                    <span id="l2-hp" class="font-mono text-lg text-green-300">100</span>%
                </div>
                <div class="flex items-center gap-2 mt-1">
                    <span class="text-blue-300 font-bold">ç•¶å‰èˆªé€Ÿ:</span> 
                    <span id="l2-speed-display" class="font-mono text-white">æ­£å¸¸</span>
                </div>
            </div>
            <button onclick="GameApp.backToMenu()" class="bg-gray-800/80 hover:bg-gray-700 text-white px-4 py-2 rounded pointer-events-auto border border-gray-600">é€€å‡ºæ¼”ç¿’</button>
        </div>

        <div id="l2-warning" class="absolute top-1/4 left-1/2 transform -translate-x-1/2 text-red-500 font-bold text-4xl hidden animate-pulse z-10 text-shadow">âš ï¸ é£›å½ˆä¾†è¥² âš ï¸</div>

        <div class="absolute bottom-6 left-1/2 transform -translate-x-1/2 flex gap-6 pointer-events-auto z-20 w-full max-w-md px-4">
            <button id="l2-btn-evade" class="flex-1 bg-gradient-to-t from-blue-700 to-blue-500 hover:from-blue-600 hover:to-blue-400 text-white p-4 rounded-xl font-bold shadow-lg active:scale-95 transition-all border-b-4 border-blue-900 group">
                <div class="text-2xl mb-1 group-active:rotate-12 transition-transform">âš¡ è›‡è¡Œé–ƒé¿</div>
                <div class="text-[10px] text-blue-100 opacity-80">çŸ­æš«ç„¡æ•µä½†<span class="text-red-300 font-bold">å¤§å¹…å¢åŠ æšˆèˆ¹</span></div>
            </button>
            <button id="l2-btn-armor" class="flex-1 bg-gradient-to-t from-gray-700 to-gray-500 hover:from-gray-600 hover:to-gray-400 text-white p-4 rounded-xl font-bold shadow-lg active:scale-95 transition-all border-b-4 border-gray-900 relative">
                <div class="text-2xl mb-1">ğŸ›¡ï¸ åŠ æ›éµæ¿</div>
                <div class="text-[10px] text-gray-200 opacity-80">æ¸›å‚·ä½†<span class="text-red-300 font-bold">èˆªé€Ÿå‰© 30%</span></div>
                <div id="l2-armor-status" class="absolute top-2 right-2 w-3 h-3 rounded-full bg-red-500 border border-black"></div>
            </button>
        </div>
    </div>

    <!-- ==================== ç¬¬ä¸‰é—œï¼šå­¤ç¨çš„ç˜é ­ ==================== -->
    <div id="screen-level3" class="screen bg-stone-900 relative font-mono overflow-hidden">
        <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/dirt-alamo.png')] opacity-30"></div>
        
        <header class="h-12 bg-black/80 border-b border-red-900 flex justify-between items-center px-4 z-20 text-red-500 flex-shrink-0">
            <h3 class="font-bold tracking-widest text-sm flex items-center gap-2">
                <span class="w-2 h-2 bg-red-500 rounded-full animate-pulse"></span>
                ç˜é ­é™£åœ° (Beachhead) - æ•µç«å£“åˆ¶ä¸­
            </h3>
            <button onclick="GameApp.backToMenu()" class="text-xs bg-gray-800 border border-gray-600 px-2 py-1 hover:bg-gray-700">æ’¤é€€ (Exit)</button>
        </header>

        <div class="flex-1 flex flex-col md:flex-row relative z-10 overflow-hidden">
            
            <!-- å·¦å´ï¼šéŠæˆ²ä¸»å€ (æ²™ç˜) -->
            <div class="flex-1 relative p-4 flex flex-col items-center justify-center overflow-hidden">
                <div class="absolute top-4 bg-black/60 px-4 py-2 rounded text-center mb-4 z-10">
                    <p class="text-yellow-400 font-bold text-lg animate-pulse">é»æ“Šå£«å…µä»¥èº²é¿ç ²æ“Šï¼</p>
                    <p class="text-xs text-gray-400">0.3ç§’å¤šç™¼é½Šå°„ï¼Œç„æº–åœˆå‡ºç¾æ™‚ç«‹åˆ»é»æ“Šï¼</p>
                </div>

                <!-- æ•£å…µå‘ç¶²æ ¼ (3x2) -->
                <div class="grid grid-cols-3 gap-4 w-full max-w-2xl aspect-[4/3] p-4" id="l3-grid">
                    <!-- JS ç”Ÿæˆ -->
                </div>
            </div>

            <!-- å³å´ï¼šæˆ°æ³è³‡è¨Šæ¬„ -->
            <div class="w-full md:w-80 bg-gray-900 border-t md:border-t-0 md:border-l border-gray-700 flex flex-col h-48 md:h-auto flex-shrink-0">
                <div class="p-4 border-b border-gray-800 bg-gray-800/50 flex-shrink-0">
                    <div class="text-xs text-gray-400 mb-1">ç¬¬äºŒæ³¢æ´è»é è¨ˆæŠµé”</div>
                    <div id="l3-timer" class="text-2xl md:text-3xl font-bold text-red-500 font-['Share_Tech_Mono']">04:00:00</div>
                    <div class="text-[10px] text-red-400 mt-1 blink">âš ï¸ åš´é‡å»¶èª¤</div>
                </div>

                <div class="p-4 border-b border-gray-800 flex-shrink-0">
                    <div class="flex justify-between items-end">
                        <span class="text-gray-400 text-xs">å€–å­˜å…µåŠ›</span>
                        <span id="l3-score" class="text-2xl font-bold text-green-500">6</span>
                    </div>
                    <div class="w-full bg-gray-700 h-2 mt-2 rounded-full">
                        <div id="l3-hp-bar" class="bg-green-500 h-full rounded-full w-full transition-all"></div>
                    </div>
                </div>

                <div class="flex-1 p-2 overflow-hidden flex flex-col">
                    <div class="text-xs text-yellow-500 font-bold mb-2 flex-shrink-0 flex items-center">
                        <span class="text-xl mr-1">ğŸ“¡</span> å°æµ·å³æ™‚æˆ°æ³
                    </div>
                    <div id="l3-news-feed" class="flex-1 overflow-y-auto text-xs space-y-2 font-mono text-gray-300 pr-1">
                        <!-- JS æ’å…¥æ–°è -->
                    </div>
                </div>
            </div>
        </div>
        <div id="l3-shake-layer" class="absolute inset-0 pointer-events-none"></div>
    </div>

    <!-- ==================== çµç®— Modal ==================== -->
    <div id="modal-result" class="fixed inset-0 bg-black/95 z-50 hidden flex items-center justify-center p-4 overflow-y-auto">
        <div class="bg-gray-800 border-2 border-gray-600 rounded-2xl max-w-md w-full p-6 text-center shadow-2xl my-auto">
            <div id="modal-icon" class="text-6xl mb-4">â˜ ï¸</div>
            <h2 id="modal-title" class="text-2xl font-bold text-white mb-2">ä»»å‹™å¤±æ•—</h2>
            <div id="modal-desc" class="text-gray-300 text-sm mb-6 text-left space-y-2 bg-gray-900/50 p-4 rounded"></div>
            <div class="text-xs text-yellow-500 mb-6 border-t border-gray-700 pt-2">
                ğŸ’¡ <span id="modal-fact">ç§‘æ™®å…§å®¹</span>
            </div>
            <button onclick="GameApp.backToMenu()" class="w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 rounded-lg">è¿”å›ä¸»é¸å–®</button>
        </div>
    </div>

    <script>
        // ==================== å…¨å±€ç®¡ç† ====================
        const GameApp = {
            currentLevel: 0,
            startLevel(n) {
                document.querySelectorAll('.screen').forEach(el => el.classList.remove('active-screen'));
                document.getElementById(`screen-level${n}`).classList.add('active-screen');
                this.currentLevel = n;
                if(n === 1) L1Game.init();
                if(n === 2) L2Game.init();
                if(n === 3) L3Game.init();
            },
            showReference() {
                document.querySelectorAll('.screen').forEach(el => el.classList.remove('active-screen'));
                document.getElementById('screen-reference').classList.add('active-screen');
                L2Game.stop(); L3Game.stop();
            },
            backToMenu() {
                L2Game.stop(); L3Game.stop();
                document.getElementById('modal-result').classList.add('hidden');
                document.querySelectorAll('.screen').forEach(el => el.classList.remove('active-screen'));
                document.getElementById('screen-menu').classList.add('active-screen');
            },
            showResult(win, title, desc, fact) {
                const modal = document.getElementById('modal-result');
                document.getElementById('modal-icon').textContent = win ? 'ğŸ¤”' : 'â˜ ï¸';
                document.getElementById('modal-title').textContent = title;
                document.getElementById('modal-title').className = win ? "text-2xl font-bold text-yellow-400" : "text-2xl font-bold text-red-500";
                document.getElementById('modal-desc').innerHTML = desc;
                document.getElementById('modal-fact').textContent = fact;
                modal.classList.remove('hidden');
            }
        };

        // ==================== ç¬¬ä¸€é—œï¼šç§‘æ™®åœ–æ–‡é‚è¼¯ ====================
        const L1Game = {
            currentIndex: 0,
            maxIndex: 3,
            init() { this.currentIndex = 0; this.updateSlide(); },
            stop() { },
            next() { if (this.currentIndex < this.maxIndex) { this.currentIndex++; this.updateSlide(); } },
            prev() { if (this.currentIndex > 0) { this.currentIndex--; this.updateSlide(); } },
            updateSlide() {
                document.querySelectorAll('.slide-container').forEach(el => el.classList.remove('active-slide'));
                document.getElementById(`l1-slide-${this.currentIndex}`).classList.add('active-slide');
                const controls = document.getElementById('l1-controls');
                if (this.currentIndex === this.maxIndex) controls.style.display = 'none'; else controls.style.display = 'flex';
                document.getElementById('l1-page-indicator').textContent = `${this.currentIndex + 1} / ${this.maxIndex + 1}`;
            }
        };

        // ==================== ç¬¬äºŒé—œï¼šæµ·å³½ç”Ÿå­˜æˆ° ====================
        const L2Game = {
            canvas: null, ctx: null, loopId: null, state: {},
            init() { 
                this.canvas = document.getElementById('l2-canvas'); this.ctx = this.canvas.getContext('2d');
                this.resize(); window.addEventListener('resize', () => this.resize());
                this.state = { active: true, dist: 100, hp: 100, baseSpeed: 0.15, armorActive: false, evadeActive: false, evadeTimer: 0, missiles: [], particles: [], frameCount: 0 };
                document.getElementById('l2-btn-evade').onmousedown = document.getElementById('l2-btn-evade').ontouchstart = () => this.triggerEvade();
                document.getElementById('l2-btn-armor').onclick = () => this.toggleArmor();
                this.updateUI(); this.loopId = requestAnimationFrame(() => this.loop());
            },
            stop() { this.state.active = false; if(this.loopId) cancelAnimationFrame(this.loopId); },
            resize() { this.canvas.width = window.innerWidth; this.canvas.height = window.innerHeight; },
            triggerEvade() {
                if(!this.state.active || this.state.evadeActive) return;
                this.state.evadeActive = true; this.state.evadeTimer = 40; this.state.hp -= 4; 
                this.addParticles(this.canvas.width/4, this.canvas.height/2, 'green'); 
            },
            toggleArmor() { this.state.armorActive = !this.state.armorActive; this.updateUI(); },
            updateUI() {
                const as = document.getElementById('l2-armor-status'); const sd = document.getElementById('l2-speed-display');
                if (this.state.armorActive) { as.className = "absolute top-2 right-2 w-3 h-3 rounded-full bg-green-500 border border-black shadow-[0_0_5px_#4ade80]"; sd.textContent = "ç·©æ…¢ (30%)"; sd.className = "font-mono text-red-400 font-bold"; } 
                else { as.className = "absolute top-2 right-2 w-3 h-3 rounded-full bg-red-900 border border-white/20"; sd.textContent = "æ­£å¸¸"; sd.className = "font-mono text-blue-300"; }
            },
            addParticles(x, y, color) { for(let i=0; i<8; i++) this.state.particles.push({ x: x, y: y, vx: (Math.random()-0.5)*10, vy: (Math.random()-0.5)*10, life: 30, color: color }); },
            loop() {
                if(!this.state.active) return;
                const s = this.state; const ctx = this.ctx; const W = this.canvas.width; const H = this.canvas.height;
                s.frameCount++;
                let currentSpeed = s.baseSpeed; if (s.armorActive) currentSpeed *= 0.3; s.dist -= currentSpeed;
                if (s.evadeActive) { s.evadeTimer--; if (s.evadeTimer <= 0) s.evadeActive = false; }
                let spawnRate = 20; if (s.dist < 80) spawnRate = 15; if (s.dist < 50) spawnRate = 10; if (s.dist < 20) spawnRate = 5;
                if (s.frameCount % spawnRate === 0) { const count = Math.random() > 0.7 ? 2 : 1; for(let i=0; i<count; i++) s.missiles.push({ x: W + Math.random() * 200, y: H * 0.3 + Math.random() * (H * 0.5), speed: 8 + Math.random() * 8, w: 30, h: 8 }); }
                ctx.fillStyle = '#1e3a8a'; ctx.fillRect(0, 0, W, H);
                ctx.fillStyle = '#3b82f6'; for(let i=0; i<5; i++) { let waveY = (H * 0.4) + (i * 80) + Math.sin((s.frameCount + i * 50) * 0.02) * 20; ctx.fillRect(0, waveY, W, 2); }
                const shipX = W * 0.15; const shipY = H * 0.6 + Math.sin(s.frameCount * 0.05) * 10;
                ctx.save(); ctx.translate(shipX, shipY);
                if (s.evadeActive) { ctx.globalAlpha = 0.5; ctx.translate((Math.random()-0.5)*20, (Math.random()-0.5)*20); }
                ctx.fillStyle = s.armorActive ? '#4b5563' : '#92400e';
                ctx.beginPath(); ctx.moveTo(-40, -10); ctx.lineTo(40, -10); ctx.lineTo(30, 20); ctx.lineTo(-30, 20); ctx.fill();
                ctx.fillStyle = '#b45309'; ctx.fillRect(-10, -25, 20, 15);
                if (s.armorActive) { ctx.strokeStyle = '#d1d5db'; ctx.lineWidth = 3; ctx.strokeRect(-42, -12, 84, 34); ctx.fillStyle = '#9ca3af'; ctx.beginPath(); ctx.arc(-35, 0, 2, 0, Math.PI*2); ctx.arc(0, 0, 2, 0, Math.PI*2); ctx.arc(35, 0, 2, 0, Math.PI*2); ctx.fill(); }
                ctx.fillStyle = s.hp < 50 ? '#84cc16' : '#fca5a5'; ctx.beginPath(); ctx.arc(0, -15, 6, 0, Math.PI*2); ctx.fill(); ctx.restore();
                for (let i = s.missiles.length - 1; i >= 0; i--) {
                    let m = s.missiles[i]; m.x -= m.speed; ctx.fillStyle = '#ef4444'; ctx.fillRect(m.x, m.y, m.w, m.h); ctx.fillStyle = '#f59e0b'; ctx.fillRect(m.x + m.w, m.y + 2, 10 + Math.random()*10, 4);
                    if (m.x < shipX + 40 && m.x + m.w > shipX - 40 && m.y < shipY + 20 && m.y + m.h > shipY - 20) {
                        if (s.evadeActive) { ctx.fillStyle = 'white'; ctx.font = 'bold 20px Arial'; ctx.fillText("MISS", shipX, shipY - 40); } else { let dmg = 15; if (s.armorActive) dmg = 5; s.hp -= dmg; this.addParticles(shipX, shipY, 'orange'); this.canvas.style.transform = `translate(${(Math.random()-0.5)*10}px, ${(Math.random()-0.5)*10}px)`; setTimeout(() => this.canvas.style.transform = 'none', 50); }
                        s.missiles.splice(i, 1); continue;
                    }
                    if (m.x < -50) s.missiles.splice(i, 1);
                }
                for (let i = s.particles.length - 1; i >= 0; i--) { let p = s.particles[i]; p.x += p.vx; p.y += p.vy; p.life--; ctx.fillStyle = p.color; ctx.globalAlpha = p.life / 30; ctx.beginPath(); ctx.arc(p.x, p.y, 3, 0, Math.PI*2); ctx.fill(); ctx.globalAlpha = 1; if(p.life <= 0) s.particles.splice(i, 1); }
                document.getElementById('l2-dist').innerText = Math.max(0, s.dist).toFixed(1); document.getElementById('l2-hp').innerText = Math.max(0, Math.floor(s.hp));
                if (s.hp <= 0) { this.state.active = false; GameApp.showResult(false, "è‘¬èº«é­šè…¹", s.armorActive ? "ä½ åŠ æ›äº†è£ç”²ï¼Œä½†éæ…¢çš„èˆªé€Ÿè®“ä½ æ‰¿å—äº†éé‡çš„æ”»æ“Šã€‚" : "è–„çš®æ¼èˆ¹ç„¡æ³•æŠµæ“‹ç¾ä»£åŒ–ç«åŠ›ã€‚", "åŠ è£é˜²è­·è£ç”²æœƒåš´é‡æ‹–æ…¢æ¼èˆ¹é€Ÿåº¦ï¼Œä½¿å…¶æˆç‚ºæµ·ä¸Šçš„å›ºå®šé¶ã€‚è€Œä¸è£ç”²å‰‡ä¸€è§¸å³ç¢ã€‚"); } else if (s.dist <= 0) { this.state.active = false; GameApp.showResult(true, "å€–å­˜ç™»å²¸", "ä½ å¥‡è¹Ÿèˆ¬åœ°æ´»ä¸‹ä¾†äº†ï¼ˆæ©Ÿç‡ < 0.1%ï¼‰ã€‚", "é›–ç„¶ä½ åˆ°äº†ï¼Œä½†èˆ¹ä¸Šçš„å£«å…µå› ç‚ºé•·é€”æšˆèˆ¹èˆ‡ææ‡¼ï¼Œæˆ°åŠ›æ‰€å‰©ç„¡å¹¾ã€‚"); } else { this.loopId = requestAnimationFrame(() => this.loop()); }
            }
        };

        // ==================== ç¬¬ä¸‰é—œï¼šç˜é ­èº²é¿çƒ (åå‘æ‰“åœ°é¼ ) ====================
        const L3Game = {
            state: {},
            intervals: [],

            init() {
                this.state = {
                    active: true,
                    soldiers: Array.from({length: 6}, () => ({ alive: true, hiding: false })),
                    score: 6,
                    timer: 4 * 60 * 60, 
                    difficulty: 2000
                };

                const grid = document.getElementById('l3-grid');
                grid.innerHTML = '';
                grid.className = "grid grid-cols-3 gap-4 w-full max-w-2xl aspect-[4/3] p-4";
                
                for(let i=0; i<6; i++) {
                    const hole = document.createElement('div');
                    hole.className = 'foxhole w-full h-full flex items-center justify-center';
                    hole.id = `hole-${i}`;
                    hole.onclick = () => this.clickSoldier(i);
                    
                    const soldier = document.createElement('div');
                    soldier.className = 'text-4xl md:text-5xl cursor-pointer select-none soldier-pop';
                    soldier.id = `soldier-${i}`;
                    soldier.innerText = 'ğŸª–';
                    hole.appendChild(soldier);

                    const aim = document.createElement('div');
                    aim.className = 'aim-reticle hidden';
                    aim.id = `aim-${i}`;
                    hole.appendChild(aim);

                    const boom = document.createElement('div');
                    boom.className = 'explosion';
                    boom.id = `boom-${i}`;
                    hole.appendChild(boom);

                    grid.appendChild(hole);
                }

                this.updateUI();
                this.addNews("æŒ‡æ®éƒ¨ï¼šç¬¬ä¸€æ¢¯éšŠç™»é™¸æˆåŠŸï¼Œå»ºç«‹ç˜é ­å ¡ã€‚");
                this.addNews("åµæŸ¥å›å ±ï¼šæ•µè»è£ç”²éƒ¨éšŠæ­£åœ¨é›†çµã€‚");

                this.intervals.push(setInterval(() => this.gameLoop(), 100));
                this.intervals.push(setInterval(() => this.spawnThreat(), 300));
                this.intervals.push(setInterval(() => this.addRandomNews(), 5000));
            },

            stop() {
                this.state.active = false;
                this.intervals.forEach(i => clearInterval(i));
                this.intervals = [];
            },

            clickSoldier(idx) {
                if (!this.state.active) return;
                const soldier = this.state.soldiers[idx];
                if (!soldier.alive || soldier.hiding) return;

                soldier.hiding = true;
                const el = document.getElementById(`soldier-${idx}`);
                el.classList.add('soldier-hide');
                
                setTimeout(() => {
                    if(this.state.active && this.state.soldiers[idx] === soldier) {
                        soldier.hiding = false;
                        el.classList.remove('soldier-hide');
                    }
                }, 1500);
            },

            spawnThreat() {
                if (!this.state.active) return;
                
                // Get all available targets first
                const available = this.state.soldiers
                    .map((s, i) => ({...s, idx: i}))
                    .filter(s => !s.hiding && document.getElementById(`aim-${s.idx}`).classList.contains('hidden'));
                
                if (available.length === 0) return;

                // Randomize count: 2 or 3
                const count = Math.min(available.length, Math.floor(Math.random() * 2) + 2);
                
                // Shuffle array to pick random distinct targets
                for (let i = available.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [available[i], available[j]] = [available[j], available[i]];
                }
                
                const targets = available.slice(0, count);

                targets.forEach(target => {
                    const idx = target.idx;
                    const aim = document.getElementById(`aim-${idx}`);
                    aim.classList.remove('hidden');
                    aim.style.animation = 'none';
                    aim.offsetHeight;
                    aim.style.animation = 'lockOn 2s linear forwards';

                    setTimeout(() => {
                        if (!this.state.active) return;
                        aim.classList.add('hidden');

                        if (this.state.soldiers[idx].hiding) {
                            console.log("Dodged!");
                        } else {
                            const boom = document.getElementById(`boom-${idx}`);
                            boom.classList.remove('boom-anim');
                            void boom.offsetWidth; 
                            boom.classList.add('boom-anim');

                            if (this.state.soldiers[idx].alive) {
                                this.killSoldier(idx);
                            } 
                        }
                    }, 2000); // Duration stays 2s for reaction time
                });
            },

            killSoldier(idx) {
                this.state.soldiers[idx].alive = false;
                this.state.score--;
                
                const el = document.getElementById(`soldier-${idx}`);
                el.innerText = 'âš°ï¸';
                el.classList.add('opacity-50');
                
                document.getElementById('l3-shake-layer').classList.add('shake');
                setTimeout(() => document.getElementById('l3-shake-layer').classList.remove('shake'), 500);

                this.updateUI();

                if (this.state.score <= 0) {
                    this.finish(false, "å…¨è»è¦†æ²’", "ä½ çš„å°éšŠåœ¨ç˜é ­è¢«ç«ç ²æ¸…é™¤æ®†ç›¡ã€‚", "ç¾ä»£æˆ°çˆ­ä¸­ï¼Œç¼ºä¹é‡æ­¦å™¨èˆ‡æ©é«”çš„è¼•æ­¥å…µï¼Œé¢å°ç«ç ²æ´—åœ°æ™‚æ¯«ç„¡ç”Ÿå­˜ç©ºé–“ã€‚");
                } else {
                    // ä¿®æ”¹ï¼šéš¨æ©Ÿæ™‚é–“å¾Œè£œå……å…µåŠ› (10~15ç§’)
                    setTimeout(() => this.respawnSoldier(idx), 10000 + Math.random() * 5000);
                }
            },

            respawnSoldier(idx) {
                if (!this.state.active || this.state.soldiers[idx].alive) return;

                this.state.soldiers[idx] = { alive: true, hiding: false };
                this.state.score++;

                const el = document.getElementById(`soldier-${idx}`);
                el.innerText = 'ğŸª–';
                el.classList.remove('opacity-50');
                el.classList.remove('soldier-hide'); 

                el.style.transition = 'transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275)';
                el.style.transform = 'scale(0)';
                
                requestAnimationFrame(() => {
                    requestAnimationFrame(() => {
                        el.style.transform = 'scale(1)';
                        setTimeout(() => {
                            el.style.transform = ''; 
                            el.style.transition = '';
                        }, 250);
                    });
                });

                this.updateUI();
                if(Math.random() > 0.7) this.addNews("å¾Œå‹¤ï¼šè£œå……å…µå·²å¡«è£œé˜²ç·šç¼ºå£ã€‚");
            },

            gameLoop() {
                this.state.timer -= 10; 
                this.updateTimer();
            },

            addRandomNews() {
                const news = [
                    "æˆ°å ±ï¼šç¬¬ 2 è­·è¡›è‰¦éšŠé­åˆ°åè‰¦é£›å½ˆé£½å’Œæ”»æ“Šã€‚",
                    "ç©ºè»ï¼šå¤±å»å°æµ·åˆ¶ç©ºæ¬Šï¼Œç„¡æ³•åŸ·è¡Œå°åœ°æ”¯æ´ã€‚",
                    "å¾Œå‹¤ï¼šé‹è¼¸èˆ¹åœ˜ç‡ƒæ²¹ä¸è¶³ï¼Œèˆªé€Ÿä¸‹é™ã€‚",
                    "å‰ç·šï¼šç™»é™¸é» B é­é‡é‡è£ç”²åæ“Šï¼Œæ­»å‚·æ…˜é‡ã€‚",
                    "æ°£è±¡ï¼šæµ·å³½é¢¨æµªå¢å¼·ï¼Œå¾ŒçºŒæ¢¯éšŠç„¡æ³•å‡ºæ¸¯ã€‚",
                    "é›·é”ï¼šåµæ¸¬åˆ°å¤šæ‰¹æ¬¡ F-16V èµ·é£›æ””æˆªã€‚",
                    "é€šè¨Šï¼šèˆ‡æŒ‡æ®è‰¦å¤±å»è¯ç¹«..."
                ];
                this.addNews(news[Math.floor(Math.random() * news.length)]);
            },

            addNews(text) {
                const container = document.getElementById('l3-news-feed');
                const div = document.createElement('div');
                div.className = 'news-ticker-item text-red-300';
                div.innerText = text;
                container.prepend(div);
                if(container.children.length > 10) container.lastChild.remove();
            },

            updateTimer() {
                let h = Math.floor(this.state.timer / 3600);
                let m = Math.floor((this.state.timer % 3600) / 60);
                let s = this.state.timer % 60;
                document.getElementById('l3-timer').innerText = 
                    `0${h}:${m<10?'0':''}${m}:${s<10?'0':''}${s}`;
            },

            updateUI() {
                document.getElementById('l3-score').innerText = this.state.score;
                document.getElementById('l3-hp-bar').style.width = (this.state.score / 6 * 100) + '%';
                if(this.state.score < 3) document.getElementById('l3-hp-bar').className = "bg-red-500 h-full rounded-full w-full transition-all";
            },

            finish(win, title, desc, fact) {
                this.stop();
                GameApp.showResult(win, title, desc, fact);
            }
        };
    </script>
</body>
</html>