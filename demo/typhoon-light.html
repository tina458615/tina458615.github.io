<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>é¢±é¢¨æ°£å€™é æ¸¬æ¨¡æ“¬å™¨</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    background: #f5f9fc;
    color: #1a3a5c;
    font-family: -apple-system, BlinkMacSystemFont, "Microsoft JhengHei", sans-serif;
    min-height: 100vh;
}
.container {
    max-width: 500px;
    margin: 0 auto;
    padding: 20px;
}
h1 {
    color: #0077aa;
    font-size: 20px;
    text-align: center;
    margin-bottom: 5px;
}
.subtitle {
    text-align: center;
    color: #6688aa;
    font-size: 13px;
    margin-bottom: 20px;
}

/* é€²åº¦æ¢ */
.progress {
    display: flex;
    justify-content: space-between;
    margin-bottom: 25px;
    padding: 0 5px;
}
.dot {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: #d0e4f0;
    color: #999;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 11px;
    font-weight: bold;
    transition: all 0.3s;
}
.dot.active { background: #0099cc; color: white; }
.dot.done { background: #00bb88; color: white; }
.line {
    flex: 1;
    height: 2px;
    background: #d0e4f0;
    margin: 9px 4px;
}

/* å¡ç‰‡ */
.card {
    background: white;
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 15px;
    box-shadow: 0 2px 8px rgba(0,100,150,0.1);
}
.step-title {
    font-size: 18px;
    color: #0077aa;
    margin-bottom: 8px;
}
.step-desc {
    color: #5577aa;
    font-size: 14px;
    line-height: 1.6;
    margin-bottom: 15px;
}

/* æŒ‰éˆ• */
.btn {
    display: block;
    width: 100%;
    padding: 14px;
    margin-bottom: 10px;
    background: #e8f4fa;
    border: 2px solid #0099cc;
    color: #0077aa;
    border-radius: 10px;
    font-size: 14px;
    text-align: left;
    cursor: pointer;
    transition: all 0.2s;
}
.btn:hover { background: #d0ebf5; }
.btn:disabled {
    background: #eee;
    border-color: #ccc;
    color: #999;
    cursor: not-allowed;
}
.btn.highlight {
    background: #fff5f0;
    border-color: #ee7744;
    color: #cc5522;
}
.btn.primary {
    background: linear-gradient(135deg, #0099cc, #0077aa);
    border: none;
    color: white;
    text-align: center;
    font-weight: bold;
}
.btn-small {
    font-size: 12px;
    color: #888;
}

/* æ—‹è½‰åœ°çƒ */
.earth-container {
    text-align: center;
    padding: 30px 0;
}
.earth {
    font-size: 100px;
    display: inline-block;
    animation: spin 3s linear infinite;
}
@keyframes spin {
    from { transform: rotateY(0deg); }
    to { transform: rotateY(360deg); }
}
.earth-text {
    color: #0077aa;
    font-size: 14px;
    margin-top: 10px;
}

/* å°ç£æ ¼å­åœ°åœ– */
.taiwan-map {
    position: relative;
    width: 200px;
    height: 280px;
    margin: 20px auto;
}
.taiwan-shape {
    position: absolute;
    width: 100%;
    height: 100%;
    background: linear-gradient(180deg, #2d8a4e 0%, #3da55d 50%, #2d8a4e 100%);
    clip-path: polygon(50% 0%, 75% 5%, 85% 15%, 90% 30%, 88% 50%, 85% 70%, 75% 85%, 60% 95%, 45% 100%, 30% 95%, 20% 85%, 15% 70%, 12% 50%, 15% 30%, 25% 15%, 35% 5%);
    border-radius: 5px;
}
.grid-overlay {
    position: absolute;
    width: 100%;
    height: 100%;
    display: grid;
    pointer-events: none;
}
.grid-coarse {
    grid-template-columns: repeat(3, 1fr);
    grid-template-rows: repeat(4, 1fr);
}
.grid-fine {
    grid-template-columns: repeat(12, 1fr);
    grid-template-rows: repeat(16, 1fr);
}
.grid-cell {
    border: 1px solid rgba(0, 150, 200, 0.5);
}
.grid-label {
    text-align: center;
    font-size: 12px;
    color: #0077aa;
    margin-top: 10px;
}

/* æç¤ºæ¨™ç±¤ */
.tag {
    display: inline-block;
    padding: 3px 8px;
    border-radius: 4px;
    font-size: 11px;
    margin-left: 8px;
}
.tag-highlight {
    background: #ff6b35;
    color: white;
}
.tag-disabled {
    background: #ddd;
    color: #888;
}

/* è³‡è¨Šæ¡† */
.info-box {
    background: #fff8f0;
    border: 1px solid #ffcc99;
    border-radius: 8px;
    padding: 12px;
    margin-top: 15px;
    font-size: 12px;
    color: #996633;
}

/* çµæœæ•¸æ“š */
.result-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
    margin: 15px 0;
}
.result-box {
    background: #f5fafd;
    border-radius: 10px;
    padding: 15px 10px;
    text-align: center;
}
.result-num {
    font-size: 24px;
    font-weight: bold;
}
.result-num.blue { color: #0088bb; }
.result-num.orange { color: #dd5533; }
.result-label {
    font-size: 11px;
    color: #6688aa;
    margin-top: 5px;
}

/* çµè«–æ¡† */
.conclusion {
    background: #fff8f0;
    border: 2px solid #ffaa66;
    border-radius: 12px;
    padding: 15px;
    margin: 15px 0;
}
.conclusion h3 {
    font-size: 14px;
    color: #dd7733;
    margin-bottom: 10px;
}
.conclusion p {
    font-size: 13px;
    color: #775544;
    line-height: 1.7;
}

/* è¼‰å…¥å‹•ç•« */
.loading {
    text-align: center;
    padding: 40px 0;
}
.loading-spinner {
    font-size: 60px;
    animation: spin 2s linear infinite;
}
.loading-text {
    color: #0077aa;
    font-size: 14px;
    margin-top: 15px;
}
.loading-sub {
    color: #8899aa;
    font-size: 12px;
    margin-top: 5px;
}
.progress-bar {
    background: #e0e8f0;
    border-radius: 10px;
    height: 8px;
    margin: 20px 40px 0;
    overflow: hidden;
}
.progress-fill {
    background: linear-gradient(90deg, #0099cc, #00bbaa);
    height: 100%;
    width: 0%;
    transition: width 0.3s;
}

/* å ±å‘Šé ­éƒ¨ */
.report-header {
    background: linear-gradient(135deg, #0099cc, #0077aa);
    border-radius: 15px;
    padding: 20px;
    color: white;
    text-align: center;
    margin-bottom: 15px;
}
.report-header .icon { font-size: 45px; margin-bottom: 8px; }
.report-header h2 { font-size: 18px; margin-bottom: 5px; }
.report-header p { font-size: 12px; opacity: 0.9; }

/* å ±å‘Šå€å¡Š */
.section {
    background: white;
    border-radius: 12px;
    padding: 15px;
    margin-bottom: 12px;
    box-shadow: 0 2px 8px rgba(0,100,150,0.1);
}
.section h3 {
    font-size: 14px;
    color: #0077aa;
    margin-bottom: 12px;
}

/* ä¾†æº */
.source {
    text-align: center;
    font-size: 11px;
    color: #8899aa;
    margin: 15px 0;
}
.source a { color: #0088bb; }

/* é‡æ–°é–‹å§‹æŒ‰éˆ• */
.restart-btn {
    display: block;
    width: 100%;
    padding: 14px;
    background: white;
    border: 2px solid #0099cc;
    color: #0077aa;
    border-radius: 10px;
    font-size: 14px;
    font-weight: bold;
    cursor: pointer;
    margin-top: 15px;
}
</style>
</head>
<body>

<div class="container">
    <h1>ğŸŒ€ é¢±é¢¨æ°£å€™è®Šé·é æ¸¬</h1>
    <p class="subtitle">è·Ÿè‘—ç§‘å­¸å®¶çš„è…³æ­¥ï¼Œæ¨¡æ“¬æœªä¾†é¢±é¢¨è®ŠåŒ–</p>
    
    <div class="progress">
        <div class="dot active" id="dot1">1</div>
        <div class="line"></div>
        <div class="dot" id="dot2">2</div>
        <div class="line"></div>
        <div class="dot" id="dot3">3</div>
        <div class="line"></div>
        <div class="dot" id="dot4">4</div>
        <div class="line"></div>
        <div class="dot" id="dot5">5</div>
        <div class="line"></div>
        <div class="dot" id="dot6">6</div>
    </div>
    
    <div id="content"></div>
</div>

<script>
var step = 1;
var substep = 0; // ç”¨æ–¼æ­¥é©Ÿå…§çš„å­ç‹€æ…‹
var data = {};

var results = {
    mid: {
        sst: '+1.5â„ƒ', humidity: '+15%', tcCount: '+10%', strongTC: '+105%',
        maxWind: '+5%', rain200km: '+20%', landRain: '+20%', surfaceWind: '+8%'
    },
    end: {
        sst: '+3â„ƒ', humidity: '+25%', tcCount: '-50%', strongTC: '+60%',
        maxWind: '+9%', rain200km: '+35%', landRain: '+40%', surfaceWind: '+10%'
    }
};

function render() {
    var h = '';
    
    // ===== æ­¥é©Ÿ 1ï¼šå»ºç«‹è™›æ“¬åœ°çƒ =====
    if (step == 1 && substep == 0) {
        h += '<div class="card">';
        h += '<div style="text-align:center; font-size:70px; margin-bottom:10px;">ğŸŒ</div>';
        h += '<h2 class="step-title">æ­¥é©Ÿ 1ï¼šå»ºç«‹è™›æ“¬åœ°çƒ</h2>';
        h += '<p class="step-desc">ç§‘å­¸å®¶ç”¨è¶…ç´šé›»è…¦å»ºç«‹ã€Œè™›æ“¬åœ°çƒã€æ°£å€™æ¨¡å¼ï¼Œæ¨¡æ“¬å¤§æ°£ã€æµ·æ´‹çš„äº¤äº’ä½œç”¨ã€‚</p>';
        h += '<button class="btn primary" onclick="selectResolution()">ğŸŒ ç”Ÿæˆè™›æ“¬åœ°çƒ</button>';
        h += '<div style="background:#e0f0f8; border-radius:8px; padding:12px; margin-top:15px;">';
        h += '<p style="font-size:12px; color:#4477aa; margin:0;">ğŸ’¡ TCCIP ä½¿ç”¨ HiRAM èˆ‡ MRI-AGCM é«˜è§£æåº¦æ¨¡å¼ï¼ˆ20-25å…¬é‡Œï¼‰ï¼Œå¯ç›´æ¥æ¨¡æ“¬é¢±é¢¨ç”Ÿæˆèˆ‡è·¯å¾‘</p>';
        h += '</div>';
        h += '</div>';
    }
    // æ­¥é©Ÿ 1ï¼šæ—‹è½‰åœ°çƒå‹•ç•«ï¼ˆå€’æ•¸ä¸­ï¼‰
    else if (step == 1 && substep == 1) {
        h += '<div class="card">';
        h += '<div class="earth-container">';
        h += '<div class="earth">ğŸŒ</div>';
        h += '<p class="earth-text">è™›æ“¬åœ°çƒå»ºç«‹ä¸­...ï¼Œå€’æ•¸ <span id="countdown">10</span> ç§’</p>';
        h += '</div>';
        h += '</div>';
        
        // å•Ÿå‹•å€’æ•¸è¨ˆæ™‚
        setTimeout(startCountdown, 100);
    }
    // æ­¥é©Ÿ 1ï¼šå€’æ•¸å®Œæˆ
    else if (step == 1 && substep == 2) {
        h += '<div class="card">';
        h += '<div class="earth-container">';
        h += '<div class="earth">ğŸŒ</div>';
        h += '<p class="earth-text" style="color:#00aa66;">âœ“ è™›æ“¬åœ°çƒå»ºç«‹å®Œæˆï¼</p>';
        h += '</div>';
        h += '<button class="btn primary" onclick="nextStep()">å‰å¾€ä¸‹ä¸€æ­¥ â†’</button>';
        h += '</div>';
    }
    
    // ===== æ­¥é©Ÿ 2ï¼šè¨­å®šæ’æ”¾æƒ…å¢ƒ =====
    else if (step == 2) {
        h += '<div class="card">';
        h += '<div style="text-align:center; font-size:70px; margin-bottom:10px;">ğŸ­</div>';
        h += '<h2 class="step-title">æ­¥é©Ÿ 2ï¼šè¨­å®šæ’æ”¾æƒ…å¢ƒ</h2>';
        h += '<p class="step-desc">æœªä¾†äººé¡æœƒæ’æ”¾å¤šå°‘æº«å®¤æ°£é«”ï¼Ÿé€™æ±ºå®šäº†åœ°çƒæš–åŒ–çš„ç¨‹åº¦ã€‚</p>';
        h += '<p style="font-size:13px; color:#6688aa; margin-bottom:12px;">é¸æ“‡æº«å®¤æ°£é«”æ’æ”¾æƒ…å¢ƒï¼š</p>';
        
        // RCP 2.6 - ä¸å¯é¸
        h += '<button class="btn" disabled>';
        h += 'ğŸŒ± <strong>RCP 2.6 ä½æ’æ”¾</strong><span class="tag tag-disabled">è³‡æ–™æœªæä¾›</span><br>';
        h += '<span class="btn-small">ç©æ¥µæ¸›ç¢³ï¼Œ2100å¹´å‡æº«ç´„1.5Â°C</span>';
        h += '</button>';
        
        // RCP 4.5 - ä¸å¯é¸
        h += '<button class="btn" disabled>';
        h += 'ğŸŒ¿ <strong>RCP 4.5 ä¸­ä½æ’æ”¾</strong><span class="tag tag-disabled">è³‡æ–™æœªæä¾›</span><br>';
        h += '<span class="btn-small">ä¸­ç­‰æ¸›ç¢³ï¼Œ2100å¹´å‡æº«ç´„2.4Â°C</span>';
        h += '</button>';
        
        // RCP 6.0 - ä¸å¯é¸
        h += '<button class="btn" disabled>';
        h += 'ğŸ¢ <strong>RCP 6.0 ä¸­é«˜æ’æ”¾</strong><span class="tag tag-disabled">è³‡æ–™æœªæä¾›</span><br>';
        h += '<span class="btn-small">æœ‰é™æ¸›ç¢³ï¼Œ2100å¹´å‡æº«ç´„3Â°C</span>';
        h += '</button>';
        
        // RCP 8.5 - å¯é¸ä¸”å¼·èª¿
        h += '<button class="btn highlight" onclick="selectRCP()">';
        h += 'ğŸ”¥ <strong>RCP 8.5 é«˜æ’æ”¾</strong><span class="tag tag-highlight">TCCIP æ¡ç”¨</span><br>';
        h += '<span class="btn-small">æŒçºŒå¤§é‡æ’æ”¾ï¼Œ2100å¹´å‡æº«ç´„3-4Â°C</span>';
        h += '</button>';
        
        h += '<div class="info-box">';
        h += 'âš ï¸ <strong>ç‚ºä»€éº¼åªæœ‰ RCP8.5ï¼Ÿ</strong><br>';
        h += 'TCCIP çš„é¢±é¢¨å‹•åŠ›é™å°ºåº¦è³‡æ–™ç›®å‰åƒ…æä¾› RCP8.5 æƒ…å¢ƒï¼Œé€™æ˜¯ç‚ºäº†è©•ä¼°æœ€åš´å³»çš„æœªä¾†æ°£å€™é¢¨éšªã€‚';
        h += '</div>';
        h += '</div>';
    }
    
    // ===== æ­¥é©Ÿ 3ï¼šæŒ‘é¸è§€å¯Ÿæ™‚é–“ =====
    else if (step == 3) {
        h += '<div class="card">';
        h += '<div style="text-align:center; font-size:70px; margin-bottom:10px;">ğŸ“…</div>';
        h += '<h2 class="step-title">æ­¥é©Ÿ 3ï¼šæŒ‘é¸è§€å¯Ÿæ™‚é–“</h2>';
        h += '<p class="step-desc">é¸æ“‡æƒ³è¦é æ¸¬çš„æœªä¾†æ™‚é–“ç¯„åœï¼Œèˆ‡åŸºæœŸï¼ˆ1979-2003å¹´ï¼‰æ¯”è¼ƒè®ŠåŒ–ã€‚</p>';
        h += '<p style="font-size:13px; color:#6688aa; margin-bottom:12px;">é¸æ“‡é æ¸¬æ™‚æœŸï¼š</p>';
        h += '<button class="btn" onclick="selectPeriod(\'mid\')">ğŸ“† <strong>ä¸–ç´€ä¸­ï¼ˆ2040-2065å¹´ï¼‰</strong><br><span class="btn-small">ç´„20-40å¹´å¾Œçš„æ°£å€™</span></button>';
        h += '<button class="btn" onclick="selectPeriod(\'end\')">ğŸ”® <strong>ä¸–ç´€æœ«ï¼ˆ2075-2099å¹´ï¼‰</strong><br><span class="btn-small">ç´„50-75å¹´å¾Œçš„æ°£å€™</span></button>';
        h += '</div>';
    }
    
    // ===== æ­¥é©Ÿ 4ï¼šå‹•åŠ›é™å°ºåº¦ï¼ˆåˆå§‹ç‹€æ…‹ï¼‰=====
    else if (step == 4 && substep == 0) {
        h += '<div class="card">';
        h += '<div style="text-align:center; font-size:70px; margin-bottom:10px;">ğŸ”¬</div>';
        h += '<h2 class="step-title">æ­¥é©Ÿ 4ï¼šå‹•åŠ›é™å°ºåº¦</h2>';
        h += '<p class="step-desc">å…¨çƒæ¨¡å¼çš„ç¶²æ ¼å¤ªå¤§ï¼ˆç´„100-400å…¬é‡Œï¼‰ï¼Œéœ€è¦ã€Œå°ç„¦ã€åˆ°è‡ºç£æ‰èƒ½çœ‹æ¸…ç´°ç¯€ã€‚</p>';
        
        // å°ç£åœ°åœ–ï¼ˆç²—æ ¼å­ï¼‰
        h += '<div class="taiwan-map">';
        h += '<div class="taiwan-shape"></div>';
        h += '<div class="grid-overlay grid-coarse" id="gridOverlay">';
        for (var i = 0; i < 12; i++) {
            h += '<div class="grid-cell"></div>';
        }
        h += '</div>';
        h += '</div>';
        h += '<p class="grid-label" id="gridLabel">ç›®å‰ï¼šGCM å…¨çƒæ¨¡å¼ç¶²æ ¼ï¼ˆç´„ 100-400 å…¬é‡Œï¼‰</p>';
        
        h += '<button class="btn primary" onclick="runDownscale()">ğŸ¯ åŸ·è¡Œå‹•åŠ›é™å°ºåº¦</button>';
        
        h += '<div style="background:#e0f0f8; border-radius:8px; padding:12px; margin-top:15px;">';
        h += '<p style="font-size:12px; color:#4477aa; margin:0;">ğŸ”ï¸ ä½¿ç”¨ WRF å€åŸŸæ¨¡å¼ï¼Œå°‡è§£æåº¦æé«˜åˆ° 5 å…¬é‡Œï¼Œæ‰èƒ½å‘ˆç¾è‡ºç£åœ°å½¢å°é¢±é¢¨é™é›¨çš„å½±éŸ¿</p>';
        h += '</div>';
        h += '</div>';
    }
    // æ­¥é©Ÿ 4ï¼šé™å°ºåº¦å®Œæˆï¼ˆç´°æ ¼å­ï¼‰
    else if (step == 4 && substep == 1) {
        h += '<div class="card">';
        h += '<div style="text-align:center; font-size:70px; margin-bottom:10px;">ğŸ”¬</div>';
        h += '<h2 class="step-title">æ­¥é©Ÿ 4ï¼šå‹•åŠ›é™å°ºåº¦</h2>';
        h += '<p class="step-desc">è§£æåº¦å·²å¾ 100-400 å…¬é‡Œæå‡åˆ° 5 å…¬é‡Œï¼</p>';
        
        // å°ç£åœ°åœ–ï¼ˆç´°æ ¼å­ï¼‰
        h += '<div class="taiwan-map">';
        h += '<div class="taiwan-shape"></div>';
        h += '<div class="grid-overlay grid-fine">';
        for (var i = 0; i < 192; i++) {
            h += '<div class="grid-cell"></div>';
        }
        h += '</div>';
        h += '</div>';
        h += '<p class="grid-label" style="color:#00aa66;">âœ“ é™å°ºåº¦å®Œæˆï¼š5 å…¬é‡Œé«˜è§£æåº¦ç¶²æ ¼</p>';
        
        h += '<button class="btn primary" onclick="nextStep()">å‰å¾€ä¸‹ä¸€æ­¥ â†’</button>';
        h += '</div>';
    }
    
    // ===== æ­¥é©Ÿ 5ï¼šçµ±è¨ˆä¾µå°é¢±é¢¨ =====
    else if (step == 5 && substep == 0) {
        h += '<div class="card">';
        h += '<div style="text-align:center; font-size:70px; margin-bottom:10px;">ğŸŒ€</div>';
        h += '<h2 class="step-title">æ­¥é©Ÿ 5ï¼šçµ±è¨ˆä¾µå°é¢±é¢¨</h2>';
        h += '<p class="step-desc">è¿½è¹¤æ¨¡æ“¬å‡ºçš„æ¯å€‹é¢±é¢¨ï¼Œçµ±è¨ˆæœƒå½±éŸ¿è‡ºç£çš„é¢±é¢¨è®ŠåŒ–ã€‚</p>';
        
        h += '<div style="background:#f5fafd; border-radius:10px; padding:12px; margin-bottom:15px;">';
        h += '<p style="font-size:13px; color:#0077aa; margin:0 0 8px; font-weight:bold;">ğŸ“Š åˆ†æé …ç›®ï¼š</p>';
        h += '<p style="font-size:13px; color:#5577aa; margin:3px 0;">â€¢ ä¾µå°é¢±é¢¨çš„æ•¸é‡è®ŠåŒ–</p>';
        h += '<p style="font-size:13px; color:#5577aa; margin:3px 0;">â€¢ é¢±é¢¨å¼·åº¦èˆ‡é¢¨é€Ÿè®ŠåŒ–</p>';
        h += '<p style="font-size:13px; color:#5577aa; margin:3px 0;">â€¢ é¢±é¢¨å¸¶ä¾†çš„é™é›¨è®ŠåŒ–</p>';
        h += '</div>';
        
        h += '<button class="btn primary" onclick="runAnalysis()">â–¶ï¸ é–‹å§‹çµ±è¨ˆåˆ†æ</button>';
        h += '</div>';
    }
    // æ­¥é©Ÿ 5ï¼šåˆ†æä¸­
    else if (step == 5 && substep == 1) {
        h += '<div class="card">';
        h += '<div class="loading">';
        h += '<div class="loading-spinner">ğŸŒ€</div>';
        h += '<p class="loading-text" id="loadingText">æ­£åœ¨çµ±è¨ˆé¢±é¢¨è³‡æ–™...</p>';
        h += '<p class="loading-sub" id="loadingSub">è¿½è¹¤è¥¿åŒ—å¤ªå¹³æ´‹é¢±é¢¨è·¯å¾‘</p>';
        h += '<div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>';
        h += '</div>';
        h += '</div>';
        
        setTimeout(function() { updateLoading(25, 'çµ±è¨ˆä¾µå°é¢±é¢¨æ•¸é‡...'); }, 600);
        setTimeout(function() { updateLoading(50, 'è¨ˆç®—é¢±é¢¨å¼·åº¦è®ŠåŒ–...'); }, 1200);
        setTimeout(function() { updateLoading(75, 'åˆ†æé¢¨é€Ÿèˆ‡é™é›¨è®ŠåŒ–...'); }, 1800);
        setTimeout(function() { updateLoading(100, 'ç”¢ç”Ÿç§‘å­¸å ±å‘Š...'); }, 2400);
        setTimeout(function() { step = 6; render(); }, 3000);
    }
    
    // ===== æ­¥é©Ÿ 6ï¼šç§‘å­¸å ±å‘Š =====
    else if (step == 6) {
        var r = results[data.period];
        var periodName = data.period == 'end' ? 'ä¸–ç´€æœ«' : 'ä¸–ç´€ä¸­';
        var periodYear = data.period == 'end' ? '2075-2099' : '2040-2065';
        
        h += '<div class="report-header">';
        h += '<div class="icon">ğŸ“Š</div>';
        h += '<h2>è‡ºç£é¢±é¢¨æ°£å€™è®Šé·é æ¸¬å ±å‘Š</h2>';
        h += '<p>RCP8.5 æƒ…å¢ƒ ï½œ ' + periodName + 'ï¼ˆ' + periodYear + 'ï¼‰</p>';
        h += '</div>';
        
        // ç’°å¢ƒè®ŠåŒ–
        h += '<div class="section">';
        h += '<h3>ğŸŒ¡ï¸ ç’°å¢ƒè®ŠåŒ–</h3>';
        h += '<div class="result-grid">';
        h += '<div class="result-box"><div class="result-num orange">' + r.sst + '</div><div class="result-label">æµ·è¡¨é¢æ°£æº«</div></div>';
        h += '<div class="result-box"><div class="result-num blue">' + r.humidity + '</div><div class="result-label">å¤§æ°£æ°´æ°£é‡</div></div>';
        h += '</div>';
        h += '</div>';
        
        // é¢±é¢¨æ•¸é‡
        h += '<div class="section">';
        h += '<h3>ğŸŒ€ é¢±é¢¨æ•¸é‡è®ŠåŒ–</h3>';
        h += '<div class="result-grid">';
        var tcColor = r.tcCount.includes('-') ? 'blue' : 'orange';
        h += '<div class="result-box"><div class="result-num ' + tcColor + '">' + r.tcCount + '</div><div class="result-label">é¢±é¢¨ç¸½æ•¸</div></div>';
        h += '<div class="result-box"><div class="result-num orange">' + r.strongTC + '</div><div class="result-label">å¼·é¢±é »ç‡</div></div>';
        h += '</div>';
        h += '</div>';
        
        // é¢¨é€Ÿè®ŠåŒ–
        h += '<div class="section">';
        h += '<h3>ğŸ’¨ é¢¨é€Ÿè®ŠåŒ–</h3>';
        h += '<div class="result-grid">';
        h += '<div class="result-box"><div class="result-num orange">' + r.maxWind + '</div><div class="result-label">è¿‘ä¸­å¿ƒæœ€å¤§é¢¨é€Ÿ</div></div>';
        h += '<div class="result-box"><div class="result-num orange">' + r.surfaceWind + '</div><div class="result-label">åœ°é¢å¹³å‡é¢¨é€Ÿ</div></div>';
        h += '</div>';
        h += '</div>';
        
        // é™é›¨è®ŠåŒ–
        h += '<div class="section">';
        h += '<h3>ğŸŒ§ï¸ é™é›¨è®ŠåŒ–</h3>';
        h += '<div class="result-grid">';
        h += '<div class="result-box"><div class="result-num orange">' + r.rain200km + '</div><div class="result-label">ä¸­å¿ƒ200kmå€åŸŸé™é›¨</div></div>';
        h += '<div class="result-box"><div class="result-num orange">' + r.landRain + '</div><div class="result-label">é™¸åœ°æ™‚é›¨é‡</div></div>';
        h += '</div>';
        h += '</div>';
        
        // çµè«–
        h += '<div class="conclusion">';
        h += '<h3>âš ï¸ ç§‘å­¸çµè«–</h3>';
        if (data.period == 'end') {
            h += '<p>åœ¨ RCP8.5 æƒ…å¢ƒä¸‹ï¼Œ<strong style="color:#0077aa;">ä¸–ç´€æœ«é¢±é¢¨ç¸½æ•¸å°‡æ¸›å°‘ 50%</strong>ï¼Œä½†<strong style="color:#dd5533;">å¼·é¢±é »ç‡å¢åŠ  60%</strong>ã€‚é¢±é¢¨å¸¶ä¾†çš„<strong style="color:#dd5533;">é™é›¨å¼·åº¦å¢åŠ  35-40%</strong>ï¼Œä»£è¡¨æœªä¾†é¢±é¢¨é›–ç„¶è®Šå°‘ï¼Œä½†æ¯æ¬¡ä¾µå°å°‡å¸¶ä¾†æ›´æ¥µç«¯çš„é¢¨é›¨ã€‚</p>';
        } else {
            h += '<p>åœ¨ RCP8.5 æƒ…å¢ƒä¸‹ï¼Œ<strong style="color:#dd5533;">ä¸–ç´€ä¸­é¢±é¢¨ç¸½æ•¸ç•¥å¢ 10%</strong>ï¼Œä¸”<strong style="color:#dd5533;">å¼·é¢±é »ç‡å¤§å¢ 105%</strong>ã€‚é¢±é¢¨<strong style="color:#dd5533;">é™é›¨å¼·åº¦å¢åŠ ç´„ 20%</strong>ï¼Œé¡¯ç¤ºè¿‘å¹¾åå¹´å…§æ¥µç«¯é¢±é¢¨äº‹ä»¶å°‡æ˜é¡¯å¢åŠ ã€‚</p>';
        }
        h += '</div>';
        
        h += '<p class="source">è³‡æ–™ä¾†æºï¼š<a href="https://tccip.ncdr.nat.gov.tw/" target="_blank">TCCIP è‡ºç£æ°£å€™è®Šé·æ¨ä¼°è³‡è¨Šèˆ‡èª¿é©çŸ¥è­˜å¹³å°</a></p>';
        
        h += '<button class="restart-btn" onclick="restart()">ğŸ”„ é‡æ–°æ¨¡æ“¬å…¶ä»–æƒ…å¢ƒ</button>';
    }
    
    document.getElementById('content').innerHTML = h;
    updateDots();
}

function updateDots() {
    for (var i = 1; i <= 6; i++) {
        var dot = document.getElementById('dot' + i);
        dot.className = 'dot';
        if (i < step) dot.className = 'dot done';
        else if (i == step) dot.className = 'dot active';
    }
}

function selectResolution() {
    data.resolution = '20km';
    substep = 1;
    render();
}

var countdownTimer = null;
var countdownValue = 10;

function startCountdown() {
    countdownValue = 10;
    updateCountdownDisplay();
    countdownTimer = setInterval(function() {
        countdownValue--;
        if (countdownValue <= 0) {
            clearInterval(countdownTimer);
            substep = 2;
            render();
        } else {
            updateCountdownDisplay();
        }
    }, 1000);
}

function updateCountdownDisplay() {
    var el = document.getElementById('countdown');
    if (el) el.innerText = countdownValue;
}

function selectRCP() {
    data.rcp = 'RCP8.5';
    step = 3;
    substep = 0;
    render();
    window.scrollTo(0, 0);
}

function selectPeriod(period) {
    data.period = period;
    step = 4;
    substep = 0;
    render();
    window.scrollTo(0, 0);
}

function runDownscale() {
    substep = 1;
    render();
}

function runAnalysis() {
    substep = 1;
    render();
}

function updateLoading(percent, text) {
    var fill = document.getElementById('progressFill');
    var sub = document.getElementById('loadingSub');
    if (fill) fill.style.width = percent + '%';
    if (sub) sub.innerText = text;
}

function nextStep() {
    step++;
    substep = 0;
    render();
    window.scrollTo(0, 0);
}

function restart() {
    step = 1;
    substep = 0;
    data = {};
    render();
    window.scrollTo(0, 0);
}

render();
</script>

</body>
</html>
